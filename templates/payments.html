{% extends "layout.html" %}

{% block title %}
    Payments
{% endblock %}

{% block main %}

{{users_trips}}

<form>
    <select onchange="submit_trip(event)" required class="form-select" aria-label="Trip Selection" name="trip">
        <option disabled selected>Select Trip</option>
        {% for users_trip in users_trips %}
        <option value="{{users_trip.trip_id}}">{{users_trip.trip_title}}</option>
        {% endfor %}
    </select>
</form>

<div hidden id="payment_form_area" class="my-3">
    <h5 class="text-center mb-5" id="trip_desc_area"></h5>
    <form class="d-flex" method="post">
        <input hidden id="trip_id_area" name="trip_id">
        <textarea aria-label="Payment Details" class="form-control" name="payment_desc" placeholder="Payment Details" rows="1"></textarea>
        <input class="form-control" name="payment_amount" type="number">
        <select class="form-select mx-1" aria-label="participant Selection" name="participant_id" id="participant_options">
        </select>
        <input class="btn btn-outline-primary" type="submit">
    </form>
</div>

<div hidden id="payment_details_area" class="my-3">
    <table>
        
    </table>
</div>

<script>

function submit_trip(event) {
    const trip_id = event.target.value
    fetch_trip(trip_id)
}

function place_trips_details(data) {

    payment_form_area = document.getElementById("payment_form_area")
    payment_form_area.hidden = false
    const {closed, owner_id, trip_descrip, trip_id, trip_title} = data.trip_data
    const participants = data.participants_data
    trip_desc_area = document.getElementById("trip_desc_area")
    trip_desc_area.innerHTML = `${trip_descrip}`

    trip_id_area = document.getElementById("trip_id_area")
    trip_id_area.value = `${trip_id}`

    participant_options = document.getElementById("participant_options")
    participant_options.innerHTML = "<option value='0'>Vendor</option>"
    participants.forEach(participant => {
        participant_options.innerHTML += `
                        <option value="${participant.id}">${participant.username}</option>
                        `
        })
}   


function fetch_trip(trip_id) {
    fetch('/trip_payments', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ "trip_id": trip_id })
    })
    .then(response => response.json())
    .then(data => place_trips_details(data))
    .catch(error => console.error(error));
}

</script>

{% endblock %}